<!doctype html>
<html lang="ko" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="hmos.dev Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="hmos.dev Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-206743648-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MFNE9LTQG8"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MFNE9LTQG8",{})</script><title data-react-helmet="true">immer ë‚´ë¶€ ì‚´í´ë³´ê¸° | hmos.dev</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://hmos.dev/img/dark-room-computer.jpeg"><meta data-react-helmet="true" name="twitter:image" content="https://hmos.dev/img/dark-room-computer.jpeg"><meta data-react-helmet="true" property="og:url" content="https://hmos.dev/deep-dive-to-immer"><meta data-react-helmet="true" name="docusaurus_locale" content="ko"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" name="og:title" content="hmos.dev"><meta data-react-helmet="true" name="og:description" content="Front-end Developer Blog"><meta data-react-helmet="true" property="og:title" content="immer ë‚´ë¶€ ì‚´í´ë³´ê¸° | hmos.dev"><meta data-react-helmet="true" name="description" content="reduxì—ì„œ ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” immerëŠ” mutableí•œ ê°ì²´ ì—…ë°ì´íŠ¸ë¥¼ immutableí•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë„ì™€ì¤€ë‹¤. ì–´ë–»ê²Œ ì´ëŸ° ë¡œì§ì´ ê°€ëŠ¥í•œê±¸ê¹Œ?"><meta data-react-helmet="true" property="og:description" content="reduxì—ì„œ ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” immerëŠ” mutableí•œ ê°ì²´ ì—…ë°ì´íŠ¸ë¥¼ immutableí•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë„ì™€ì¤€ë‹¤. ì–´ë–»ê²Œ ì´ëŸ° ë¡œì§ì´ ê°€ëŠ¥í•œê±¸ê¹Œ?"><meta data-react-helmet="true" name="keywords" content="redux,redux-toolkit,immer,immutable,javascript,deep-dive,how-to-work,web"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-10-23T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/HyunmoAhn"><meta data-react-helmet="true" property="article:tag" content="redux,redux-toolkit,immer,library,how-to-work,deep-dive,javascript,web,immutable"><link data-react-helmet="true" rel="shortcut icon" href="/favicon/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hmos.dev/deep-dive-to-immer"><link data-react-helmet="true" rel="alternate" href="https://hmos.dev/deep-dive-to-immer" hreflang="ko"><link data-react-helmet="true" rel="alternate" href="https://hmos.dev/en/deep-dive-to-immer" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hmos.dev/deep-dive-to-immer" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d5a1afa6.css">
<link rel="preload" href="/assets/js/runtime~main.1447f857.js" as="script">
<link rel="preload" href="/assets/js/main.47fa5a87.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">ë³¸ë¬¸ìœ¼ë¡œ ê±´ë„ˆë›°ê¸°</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="hmos Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="hmos Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">hmos.dev</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/tags">Tags</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>í•œêµ­ì–´</span></span></a><ul class="dropdown__menu"><li><a href="/deep-dive-to-immer" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">í•œêµ­ì–´</a></li><li><a href="/en/deep-dive-to-immer" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li></ul></div><a href="https://github.com/HyunmoAhn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--checked react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/deep-dive-to-immer">immer ë‚´ë¶€ ì‚´í´ë³´ê¸°</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/how-to-time-travel-debugging-at-redux-devtools">redux-devtoolsì˜ time-travel-debugging í†ºì•„ë³´ê¸°</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/how-to-cancel-at-axios">How to cancel at axios</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">immer ë‚´ë¶€ ì‚´í´ë³´ê¸°</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-10-23T00:00:00.000Z" itemprop="datePublished">2021ë…„ 10ì›” 23ì¼</time> Â· ì•½ 21ë¶„</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/HyunmoAhn" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/HyunmoAhn.png" alt="Hyunmo Ahn"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/HyunmoAhn" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Hyunmo Ahn</span></a></div><small class="avatar__subtitle" itemprop="description">Front End Engineer @ Line Financial+</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>ì´ ê¸€ì€ ê¸°ë³¸ì ìœ¼ë¡œ <a href="https://immerjs.github.io/immer/" target="_blank" rel="noopener noreferrer">immer</a>ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ëŠ” ì‹œê°„ì„ ê°€ì§„ë‹¤. ë§Œì•½ immerë¥¼ ì˜ ëª¨ë¥´ëŠ” ë¶„ë“¤ì€ <a href="#immer%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%B4%EA%B3%A0-%EC%99%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94%EA%B1%B8%EA%B9%8C">ì•„ë˜ ì±•í„°</a>ë¥¼ ë¨¼ì € ì½ì–´ë³´ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="ë¬´ì—‡ì´-ê¶ê¸ˆí• ê¹Œ"></a>ë¬´ì—‡ì´ ê¶ê¸ˆí• ê¹Œ?<a class="hash-link" href="#ë¬´ì—‡ì´-ê¶ê¸ˆí• ê¹Œ" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h2><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Question</h5></div><div class="admonition-content"><p>Q1. <code>immer</code>ëŠ” ê°ì²´ mutableí•˜ê²Œ ë°”ê¾¸ëŠ” ë°©ì‹ì„ ì–´ë–»ê²Œ immutableí•œ ë°©ì‹ìœ¼ë¡œ ë°”ê¾¸ì–´ì£¼ê³  ìˆì„ê¹Œ? </p></div></div><p>immerëŠ” mutableí•˜ê²Œ ë³€ê²½í•˜ëŠ” ê°ì²´ built-in methodë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ immutableí•˜ê²Œ ë°ì´í„°ë¥¼ ë°˜í™˜í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ í•œë‹¤. ì´ ê¸°ëŠ¥ì´ ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì´ë£¨ì–´ì§€ëŠ”ì§€ ì•Œì•„ë³¸ë‹¤.</p><p>ì•„ë˜ ì½”ë“œ ì˜ˆì‹œëŠ” <a href="https://immerjs.github.io/immer/#a-quick-example-for-comparison" target="_blank" rel="noopener noreferrer">immer ê³µì‹ ë¬¸ì„œ</a>ì— ì¡´ì¬í•˜ëŠ” basic exampleì„ ê°€ì ¸ì˜¨ ê²ƒì´ë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> produce </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;immer&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> baseState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Learn TypeScript&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    done</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Try Immer&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    done</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> nextState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">produce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">baseState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Tweet about It&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">done </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">baseState </span><span class="token operator">===</span><span class="token plain"> nextState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// false</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">nextState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">/*</span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">[</span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">  { </span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">    title: &quot;Learn TypeScript&quot;, </span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">    done: true,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">  },</span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">  { </span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">    title: &quot;Learn TypeScript&quot;, </span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">    done: true,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">  },</span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">  { </span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">    title: &quot;Tweet about It&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">  },</span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">*/</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Question</h5></div><div class="admonition-content"><p>Q2. <code>immer</code>ëŠ” ì–´ë–»ê²Œ structural sharingì„ ì‚¬ìš©í•˜ëŠ”ê±¸ê¹Œ?</p><p>*<code>structural sharing</code>: ê°ì²´ë¥¼ copyí•  ë•Œ ë³€ê²½ë˜ì§€ ì•Šì€ ê°ì²´ëŠ” referenceë¥¼ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹.</p></div></div><p>ê°ì²´ë¥¼ immutableí•˜ê²Œ ì—…ë°ì´íŠ¸ í•œë‹¤ëŠ” ê²ƒì€ ê¸°ì¡´ ê°ì²´ë¥¼ ìƒˆë¡œìš´ ê°ì²´ë¡œ ë³µì‚¬í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ì¦‰, ë³µì‚¬ì— ë¹„ìš©ì´ ë°œìƒí•œë‹¤.
immerëŠ” ê°ì²´ë¥¼ ë³µì‚¬í•  ë•Œ, ë³€ê²½ë˜ì§€ ì•Šì€ referenceëŠ” ì¬ì‚¬ìš©í•˜ëŠ” structural sharing ë°©ì‹ì„ ì‚¬ìš©í•´ì„œ ê°ì²´ë¥¼ ë³µì‚¬í•œë‹¤.
immerì—ì„œëŠ” ì–´ë–¤ë°©ì‹ì„ ì‚¬ìš©í•´ì„œ structural sharingì„ ì‚¬ìš©í•˜ê³  ìˆëŠ”ì§€ ì•Œì•„ë³¸ë‹¤.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Question</h5></div><div class="admonition-content"><p>Q3. immerì—ì„œëŠ” produceí•¨ìˆ˜ ë‚´ì—ì„œ draftë¥¼ ì§ì ‘ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ì´ ì•„ë‹ˆë¼ returnì„ í†µí•´ì„œ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²½ìš°ê°€ ìˆëŠ”ë°, ì´ëŸ° ê²½ìš°ì— ë¡œì§ì´ ë‹¤ë¥¸ì§€?</p></div></div><p>immerë¥¼ ì‚¬ìš©í•  ë•Œ, ìœ„ì—ì„œ ì œì‹œí•œ mutableí•œ ê°ì²´ ë³€ê²½ ë°©ì‹ì´ ì•„ë‹Œ, ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë¦¬í„´í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤.
ì´ëŠ” immerì™€ëŠ” ë¬´ê´€í•˜ê²Œ immutableí•˜ê²Œ Javascriptì—ì„œ ê°ì²´ë¥¼ ë°˜í™˜í•´ì£¼ëŠ” ë°©ì‹ê³¼ ë™ì¼í•˜ë‹¤.
immerì—ì„œëŠ” ì´ëŸ¬í•œ ë°©ì‹ì„ <a href="https://immerjs.github.io/immer/return" target="_blank" rel="noopener noreferrer">ê³µì‹ì ìœ¼ë¡œ í—ˆìš©</a>í•˜ê³  ìˆê³ 
ë‘ ë°©ì‹, mutableí•˜ê²Œ ê°ì²´ë¥¼ ë³€ê²½í•˜ëŠ” ë°©ì‹ê³¼ immutableí•˜ê²Œ ê°ì²´ë¥¼ ë³€ê²½ì‹œí‚¤ëŠ” ë°©ì‹ ëª¨ë‘ í˜¼ìš©í•´ì„œ ì“°ëŠ” ê°œë°œìë„ ë§ì„ ê²ƒ ì´ë‹¤.
ì´ëŸ¬í•œ ë°©ì‹ ì°¨ì´ëŠ” immerì—ì„œ ì–´ë–¤ ë¡œì§ì°¨ì´ë¥¼ ë°œìƒì‹œí‚¤ëŠ”ì§€ ì•Œì•„ë³¸ë‹¤. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// mutable method</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> nextState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">produce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">baseState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Tweet about It&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">done </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// immutable method</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> nextState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">produce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">baseState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">...</span><span class="token plain">baseState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token operator">...</span><span class="token plain">baseState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> done</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Tweet about It&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ì‚¬ì „ì§€ì‹</h5></div><div class="admonition-content"><ul><li>immer í˜¹ì€ redux-toolkitì„ ì‚¬ìš©í•´ ë³¸ ê²½í—˜</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener noreferrer">Proxy</a>ì— ëŒ€í•œ ì´í•´ (optional)</li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="immerëŠ”-ë¬´ì—‡ì´ê³ -ì™œ-ì‚¬ìš©í•˜ëŠ”ê±¸ê¹Œ"></a>ImmerëŠ” ë¬´ì—‡ì´ê³ , ì™œ ì‚¬ìš©í•˜ëŠ”ê±¸ê¹Œ?<a class="hash-link" href="#immerëŠ”-ë¬´ì—‡ì´ê³ -ì™œ-ì‚¬ìš©í•˜ëŠ”ê±¸ê¹Œ" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h2><p><strong><em>immerë¥¼ ì™œ ì‚¬ìš©í•˜ëŠ”ì§€ ì˜ ì´í•´í•˜ê³  ìˆë‹¤ë©´ ì§€ë£¨í•œ ì´ì•¼ê¸°ê°€ ë  ìˆ˜ ìˆë‹¤. ì•Œê³  ìˆë‹¤ë©´ <a href="#%EC%82%AC%EC%9A%A9%EB%B2%95">ë‹¤ìŒ ì±•í„°ë¡œ ë„˜ì–´ê°€ì</a>.</em></strong></p><p><a href="https://immerjs.github.io/immer/" target="_blank" rel="noopener noreferrer">immer</a>ë€ ë¬´ì—‡ì¸ê°€? immer ê³µì‹ ë¬¸ì„œì—ì„œì˜ ì†Œê°œ ë¬¸êµ¬ë¥¼ ê°€ì ¸ì™€ë³´ì.</p><blockquote><p><code>Immer</code> (German for: always) is a tiny package that allows you to work with immutable state in a more convenient way.</p></blockquote><p>immerëŠ” javascriptì—ì„œ dataê°€ immutableí•˜ê²Œ ì—…ë°ì´íŠ¸ ë˜ëŠ” ê²ƒì„ ë³´ì¥í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.</p><p>ê·¸ë ‡ë‹¤ë©´ immerëŠ” ì–´ë””ì„œ ì“°ì´ê³  ìˆì„ê¹Œ? <br>
reduxì˜ style guideì—ì„œëŠ” <a href="https://ko.redux.js.org/style-guide/style-guide#use-redux-toolkit-for-writing-redux-logic" target="_blank" rel="noopener noreferrer">redux-toolkitì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥</a>í•˜ê³  ìˆê³  immutable data ê´€ë¦¬ë¥¼ ìœ„í•´ì„œëŠ”
<a href="https://ko.redux.js.org/style-guide/style-guide#use-immer-for-writing-immutable-updates" target="_blank" rel="noopener noreferrer">immerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  ê¶Œì¥</a>í•˜ê³  ìˆë‹¤.
ë¬¼ë¡  <a href="https://redux-toolkit.js.org/" target="_blank" rel="noopener noreferrer">redux-toolkit</a>ì—ëŠ” immerë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë¯€ë¡œ redux-toolkitì„
ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´ ì´ë¯¸ reduxì— immerë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒì´ë‹¤.</p><p>ì™œ immutable dataë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ”ê°€ëŠ” <a href="https://ko.redux.js.org/style-guide/style-guide#use-immer-for-writing-immutable-updates" target="_blank" rel="noopener noreferrer">reduxì˜ FAQí•­ëª©</a>ì„ ì°¸ê³ í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. <br>
ë‚´ìš©ì„ ê°„ëµí•˜ê²Œ ì„¤ëª…í•˜ìë©´, ë‹¤ìŒê³¼ ê°™ë‹¤. <br>
javascriptì—ì„œëŠ” primitiveí•œ íƒ€ì…ì˜ ë³€ìˆ˜(number, string, etc)ë¥¼ ì œì™¸í•˜ë©´ ëª¨ë‘ mutableí•œ ì†ì„±ì„ ê°€ì§„ë‹¤.
non-primitiveí•œ íƒ€ì…ì€ object, arrayì™€ ê°™ì€ ê²ƒë“¤ì´ ìˆë‹¤.
non-primitiveí•œ íƒ€ì…ì˜ ë³€ìˆ˜ëŠ” ë³€ê²½ë˜ì–´ë„ ë³€ìˆ˜ì˜ referenceê°€ ë°”ë€Œì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ object ë‚´ë¶€ê°€ ë³€ê²½ë˜ë”ë¼ë„ referenceê°€ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> primitive </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> primitive2 </span><span class="token operator">=</span><span class="token plain"> primitive</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">primitive </span><span class="token operator">===</span><span class="token plain"> primitive2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// true</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">primitive2 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">primitive </span><span class="token operator">===</span><span class="token plain"> primitive2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// false</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> nonPrimitive </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> nonPrimitive2 </span><span class="token operator">=</span><span class="token plain"> nonPrimitive</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">nonPrimitive </span><span class="token operator">===</span><span class="token plain"> nonPrimitive2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// true</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nonPrimitive2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">b </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">nonPrimitive </span><span class="token operator">===</span><span class="token plain"> nonPrimitive2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// true</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">nonPrimitive</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// { a: 5, b: 10 }  </span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p><a href="https://redux-saga.js.org/" target="_blank" rel="noopener noreferrer">redux</a>ì—ì„œëŠ” shallow equality checkingì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤. shallow equality checkingì€ ë°ì´í„°ê°€ ë™ì¼í•œì§€ ë¹„êµí•  ë•Œ,
ë°ì´í„° ë‚´ë¶€ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë°ì´í„°ì˜ referenceê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ë§Œ ì²´í¬ë¥¼ í•˜ê³  ë™ì¼í•˜ë©´ ë³€ê²½ë˜ì§€ ì•Šì•˜ë‹¤ê³  íŒë‹¨í•˜ëŠ” ê²ƒì´ë‹¤.</p><p>ë§Œì•½ deep equality checkingì„ ì‚¬ìš©í•˜ë©´ ëª¨ë“  ê°ì²´ë¥¼ í•˜ë‚˜ì”© ë¹„êµí•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ìƒ ì†í•´ë¥¼ ë³´ê²Œëœë‹¤.
ê·¸ë˜ì„œ objectê°’ì„ ë³€ê²½í•  ë•Œ referenceë„ ë³€ê²½ë˜ëŠ” ê²ƒì„ ë³´ì¥í•˜ëŠ” immutable dataë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ì—ˆê³  ì–´ë–¤ ë³€ê²½ì´ë”ë¼ë„ ê°ì²´ê°€ immutableí•¨ì„ ë³´ì¥í•´ì£¼ëŠ” immerë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.</p><p>ë§Œì•½ ë”°ë¡œ immerë¥¼ ì˜ì‹ì ìœ¼ë¡œ ì‚¬ìš©í•œ ì ì´ ì—†ë”ë¼ë„, reduxë¥¼ ì‚¬ìš©í•˜ëŠ”ë° redux-toolkitì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´
ì´ë¯¸ immerë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒì´ë‹¤.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="ì‚¬ìš©ë²•"></a>ì‚¬ìš©ë²•<a class="hash-link" href="#ì‚¬ìš©ë²•" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h2><p>immerì˜ ë‚´ë¶€ë¥¼ í™•ì¸í•˜ê¸° ì „ì— immerë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ í•œë²ˆ í™•ì¸í•´ë³´ì.
ë‹¤ìŒì€ <a href="https://immerjs.github.io/immer/#a-quick-example-for-comparison" target="_blank" rel="noopener noreferrer">immer docs</a>ì— ë‚˜ì™€ ìˆëŠ” ì˜ˆì œì´ë‹¤.</p><ul><li>baseStateë¥¼ immutableí•˜ê²Œ ë³€ê²½í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë¹„êµ.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> baseState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Learn TypeScript&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    done</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Try Immer&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    done</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// without immer</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> nextState </span><span class="token operator">=</span><span class="token plain"> baseState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">slice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nextState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">...</span><span class="token plain">nextState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  done</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nextState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Tweet about it&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// with immer</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> produce </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;immer&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> nextState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">produce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">baseState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token parameter">draft</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">done </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Tweet about it&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>immerë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ë³µì‚¬ â†’ ì—…ë°ì´íŠ¸ ê³¼ì •ì„ ì§„í–‰í•˜ê³ , ì´ ê³¼ì •ì—ì„œ mutableí•˜ê²Œ ë³€ê²½ë˜ì§„ ì•ŠëŠ”ì§€ í™•ì¸í•´ì•¼í•˜ëŠ” ë°˜ë©´,
immerì˜ <code>produce</code> ë¥¼ ì‚¬ìš©í•˜ë©´ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ë”ë¼ë„ dataê°€ immutableí•˜ë‹¤ëŠ” ê²ƒì„ ë³´ì¥ í•  ìˆ˜ ìˆë‹¤.</p><p>ë§Œì•½ immerë¥¼ ì§ì ‘ ì‚¬ìš©í•´ ë³¸ ì  ì—†ê³ , <a href="https://redux-toolkit.js.org/" target="_blank" rel="noopener noreferrer">redux-toolkit</a>ì„ ì‚¬ìš©í•´ì„œ reduxë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤ë©´ immerë¥¼ ì´ë¯¸ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒì´ë‹¤.
ì˜ ëª¨ë¥´ê² ë‹¤ë©´ redux-toolkitì—ì„œ stateë¥¼ mutationí•˜ëŠ” <a href="https://redux-toolkit.js.org/api/createReducer#direct-state-mutation" target="_blank" rel="noopener noreferrer">ë°©ë²•ì— ëŒ€í•œ ë¬¸ì„œ</a>ë¥¼ ì½ì–´ë³´ì.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="deep-dive-ì „-immerì—-ëŒ€í•´ì„œ"></a>deep-dive ì „ immerì— ëŒ€í•´ì„œ<a class="hash-link" href="#deep-dive-ì „-immerì—-ëŒ€í•´ì„œ" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h2><p>ë¨¼ì € immerì˜ ì›ë¦¬ë¥¼ ì´ì•¼ê¸° í•´ë³¼ ì˜ˆì •ì´ë‹¤.
ì—¬ê¸°ì„œ ì„¤ëª…í•˜ëŠ” ë‚´ìš©ì€ <a href="https://immerjs.github.io/immer/#how-immer-works" target="_blank" rel="noopener noreferrer">immerì˜ ë¬¸ì„œ</a>ì™€ ë¬¸ì„œì˜ FAQì— ë§í¬ë˜ì–´ ìˆëŠ”
<a href="https://medium.com/hackernoon/introducing-immer-immutability-the-easy-way-9d73d8f71cb3#3bff" target="_blank" rel="noopener noreferrer">blog ê¸€</a> ì„ ì°¸ê³ í•˜ë©´ ë” ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="immerëŠ”-ì›ë˜-ê°ì²´ë¥¼-ë³€ê²½ì‹œí‚¤ì§€-ì•ŠëŠ”ë‹¤"></a>immerëŠ” ì›ë˜ ê°ì²´ë¥¼ ë³€ê²½ì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤.<a class="hash-link" href="#immerëŠ”-ì›ë˜-ê°ì²´ë¥¼-ë³€ê²½ì‹œí‚¤ì§€-ì•ŠëŠ”ë‹¤" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h3><p>immerëŠ” ê°ì²´ë¥¼ ì§ì ‘ ë³€ê²½í•˜ì§€ ì•Šê³  original data(<code>base_</code>)ë¥¼ ê·¸ëŒ€ë¡œ ë‘ê³ , copy data(<code>copy_</code>)ë¥¼ ìƒì„±í•˜ê³  ë³€ê²½í•˜ëŠ” ë™ì‘ì„ ì§„í–‰í•œë‹¤.
ì´ëŸ° ì›ë¦¬ë¥¼ ì´ìš©í•´ì„œ ê¸°ì¡´ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ì§€ ì•Šì€ ì±„ ë³€ê²½ëœ ë°ì´í„°ë¥¼ ë¦¬í„´í•œë‹¤.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="immerëŠ”-ê°ì²´ê°€-ë³€ê²½ë˜ì—ˆëŠ”ì§€ë¥¼-ê¸°ë¡í•œë‹¤"></a>immerëŠ” ê°ì²´ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ë¥¼ ê¸°ë¡í•œë‹¤.<a class="hash-link" href="#immerëŠ”-ê°ì²´ê°€-ë³€ê²½ë˜ì—ˆëŠ”ì§€ë¥¼-ê¸°ë¡í•œë‹¤" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h3><p>immerëŠ” ê°ì²´ë¥¼ ë³€ê²½í•  ë•Œ modified flagë¥¼ <code>true</code>ë¡œ ì„¤ì •í•œë‹¤.
ë§Œì•½ ê°ì²´ íŠ¸ë¦¬ì˜ ê¹Šìˆ™í•œ ê³³ì´ ë³€ê²½ë˜ì—ˆë‹¤ë©´ ë³€ê²½ëœ ìì‹ ì„ í¬í•¨í•˜ì—¬ root íŠ¸ë¦¬ê¹Œì§€ modified flagë¥¼ ë³€ê²½í•˜ì—¬ rootì—ì„œë„ ê°ì²´ íŠ¸ë¦¬ì˜ ëê¹Œì§€ ìˆœíšŒí•  ìˆ˜ ìˆë„ë¡ ì¡°ì •í•œë‹¤.</p><p>ê°ì²´ ë³€ê²½ê³¼ì •ì„ ë§ˆì¹œ ë’¤ì—ëŠ” modified flagë¥¼ í™•ì¸í•˜ì—¬ ë³€ê²½ëœ ê°ì²´ë“¤ë§Œ copy data(<code>copy_</code>)ë¥¼ ì‚¬ìš©í•˜ê³ 
modified ë˜ì§€ ì•Šì•˜ë‹¤ë©´ original data(<code>base_</code>)ë¥¼ ì‚¬ìš©í•´ì„œ ê¸°ì¡´ referenceë¥¼ ì¬ì‚¬ìš©í•¨ìœ¼ë¡œì¨ structural shareë¥¼ ì‚¬ìš©í•œë‹¤.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="recap"></a>Recap<a class="hash-link" href="#recap" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h3><p>ì¦‰, ì •ë¦¬í•˜ìë©´ ë‹¤ìŒê³¼ ê°™ì´ 3ì¤„ë¡œ ì •ë¦¬ëœë‹¤.</p><ul><li>original dataì™€ copy data 2ê°€ì§€ ê°ì²´ë¥¼ ê´€ë¦¬í•˜ì—¬ ì›ë³¸ì„ ë³´ì¡´í•˜ê³  copy dataë§Œ ë³€ê²½í•œë‹¤.</li><li>ë³€ê²½í•œ ê°ì²´ëŠ” modified flagë¥¼ ì¼œì„œ root treeì—ì„œ leaf treeê¹Œì§€ ìˆœíšŒí•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.</li><li>ë³€ê²½ì´ ì™„ë£Œëœ ë’¤ modifed flagë¥¼ ì´ìš©í•´ì„œ ìƒˆ ê°ì²´ì™€ ê¸°ì¡´ ê°ì²´ë¥¼ í•©ì„±í•˜ëŠ” ê³¼ì •ì„ ì§„í–‰í•œë‹¤.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="deep-dive-to-immer"></a>Deep dive to immer<a class="hash-link" href="#deep-dive-to-immer" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h2><p>ì, immerë¡œ deep dive í•´ë³´ì. <br>
immer ë¡œì§ì„ í™•ì¸í•´ë³´ë ¤ë©´ usageì—ì„œ ì‚¬ìš©í–ˆë˜ <code>produce</code> í•¨ìˆ˜ë¥¼ ë¨¼ì € ì‚´í´ë´ì•¼í•œë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/v9.0.6/src/immer.ts#L23-L45</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> immer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Immer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> produce </span><span class="token operator">=</span><span class="token plain"> immer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">produce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain"> produce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>produceí•¨ìˆ˜ëŠ” <code>Immer</code> í´ë˜ìŠ¤ì˜ ë©”ì†Œë“œ í•¨ìˆ˜ì´ë‹¤. <code>Immer</code> class ì•ˆì„ ì‚´í´ë³´ì.</p><p>produceí•¨ìˆ˜ì—ì„œ curring í•¨ìˆ˜ ëŒ€ì‘ê³¼ ì—¬ëŸ¬ ì˜ˆì™¸ ì¼€ì´ìŠ¤ë¥¼ ì œì™¸í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¶•ì†Œëœë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/v9.0.6/src/core/immerClass.ts#L66-L122</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Immer</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">produce</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">base</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> recipe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> scope </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">enterScope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> proxy </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">createProxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">undefined</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">recipe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">processResult</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> scope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">     </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p><code>produce</code> í•¨ìˆ˜ê°€ ìƒê°ë³´ë‹¤ ê°„ë‹¨í•˜ë‹ˆ, ì—¬ê¸°ì„œ produce í•¨ìˆ˜ ë¡œì§ì˜ ìˆœì„œë¥¼ ì§šê³  ë„˜ì–´ê°€ì.</p><ol><li><code>produce</code> í•¨ìˆ˜ëŠ” ê¸°ì¡´ ê°ì²´(<code>base</code>)ì™€ ê°ì²´ë¥¼ ì–´ë–»ê²Œ ë³€ê²½ì‹œí‚¬ì§€ ê²°ì •í•˜ëŠ” í•¨ìˆ˜(<code>recipe</code>)ë¥¼ ì¸ìë¡œ ë°›ëŠ”ë‹¤.</li><li><code>scope</code>ë¥¼ ìƒì„±í•œë‹¤.</li><li><code>proxy</code>ë¥¼ ìƒì„±í•œë‹¤.</li><li><code>proxy</code>ë¥¼ ì´ìš©í•´ì„œ <code>recipe</code>ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.</li><li><code>processResult</code>ë¥¼ ì´ìš©í•´ì„œ ì—…ë°ì´íŠ¸ ëœ ìµœì¢… ê°ì²´ë¥¼ ë¦¬í„´í•œë‹¤.</li></ol><p>ì—¬ê¸°ì„œ ì˜ë¬¸ì„ ê°€ì ¸ì•¼í•˜ëŠ” ì ì€ mutableí•˜ê²Œ ë³€ê²½ì‹œí‚¤ëŠ” ë¡œì§ì´ <code>recipe</code>ì— í¬í•¨ë˜ì–´ ìˆê³  <code>recipe</code>ëŠ” ë‹¨ìˆœíˆ í˜¸ì¶œë  ë¿ì´ë¼ëŠ” ê²ƒì´ë‹¤.
í•˜ì§€ë§Œ <code>recipe</code> ë‚´ë¶€ì˜ mutableí•œ ë³€ê²½ë¡œì§ì€ ëŒ€ìƒ ê°ì²´ë¥¼ ì§ì ‘ ë³€ê²½í•˜ì§€ ì•Šê³  immutableì„ ë³´ì¥ì‹œì¼œì¤€ë‹¤.</p><p>ë¹„ë°€ì€ <code>proxy</code>ì— ìˆì„ ê²ƒ ê°™ë‹¤. ì‹¤ì œë¡œ <code>proxy</code>ë¥¼ ë§Œë“¤ ë•Œ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener noreferrer">new Proxy</a>ë¥¼
ì‚¬ìš©í•˜ê³  ìˆê³ , ì´ <code>new Proxy</code>ê°€ immerì˜ ì£¼ìš” ë¡œì§ì— key pointë¡œ ì‘ìš©í•œë‹¤.</p><p>ì°¨ê·¼ì°¨ê·¼ í•˜ë‚˜ì”© ì‚´í´ë³´ì.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="scope"></a>scope<a class="hash-link" href="#scope" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h3><p>scopeëŠ” immer ì „ì—­ì—ì„œ ì‚¬ìš©í•  ì •ë³´ë“¤ì„ ì €ì¥í•˜ëŠ” ê°ì²´ì´ë‹¤. immerì˜ ê¸°ë³¸ë™ì‘ì—ëŠ” í¬ê²Œ ì“°ì´ì§€ ì•Šìœ¼ë¯€ë¡œ ì–´ë–¤ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ìˆëŠ”ì§€ë§Œ í›‘ê³  ë„˜ì–´ê°€ì.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/v9.0.6/src/core/scope.ts#L33-L46</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">createScope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token parameter">parent_</span><span class="token parameter operator">:</span><span class="token parameter"> ImmerScope </span><span class="token parameter operator">|</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:rgb(189, 147, 249);font-style:italic">undefined</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token parameter">  immer_</span><span class="token parameter operator">:</span><span class="token parameter"> Immer</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">ImmerScope</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    drafts_</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    parent_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    immer_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canAutoFreeze_</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    unfinalizedDrafts_</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">   </span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p><code>drafts_</code>ëŠ” ë‚˜ì¤‘ì— ë§Œë“œëŠ” <code>proxy</code> ë¥¼ ìƒì„±í•  ë•Œ í•˜ë‚˜ì”© ë‹´ê¸°ëŠ” ë°°ì—´ì´ê³  <code>immer_</code>ëŠ” immer í´ë˜ìŠ¤ë¥¼ ë‹´ëŠ” ê³µê°„ì´ë‹¤.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="proxy"></a>proxy<a class="hash-link" href="#proxy" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h3><p>immerì˜ í•µì‹¬ì´ ë˜ëŠ” <code>proxy</code>ì— ëŒ€í•´ì„œ í™•ì¸í•´ë³´ì.</p><p>immerì—ì„œëŠ” Object ë¿ ì•„ë‹ˆë¼ Array, Map, Set ê·¸ë¦¬ê³  Proxyë¥¼ ì“°ì§€ ëª»í•˜ëŠ” ê²½ìš°(ES5)ê¹Œì§€ ëŒ€ì‘í•˜ë¯€ë¡œ ì½”ë“œê°€ ë³µì¡í•´ë³´ì´ëŠ”ë°,
Objectë§Œìœ¼ë¡œ í•œì •í•´ì„œ ë³¸ë‹¤ë©´ ë¡œì§ì´ ì¡°ê¸ˆ ê°„ë‹¨í•´ì§„ë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/v9.0.6/src/core/immerClass.ts#L212-L229</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">createProxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">immer</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> value</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> draft </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">createProxyProxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> scope </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getCurrentScope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  scope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">drafts_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>proxyë¥¼ ì–´ë–»ê²Œ ë§Œë“œëŠ”ì§€ëŠ” <code>createProxyProxy</code> í•¨ìˆ˜ë¥¼ í•œë²ˆ ë” ë“¤ì–´ê°€ì•¼ í™•ì¸í•  ìˆ˜ ìˆê² ì§€ë§Œ,
ì—¬ê¸°ì„œ ì£¼ëª©í•  ì ì€ <code>scope.drafts_</code> ì— ìƒì„±í•œ proxyë¥¼ ë„£ì–´ë‘”ë‹¤ëŠ” ê²ƒì´ë‹¤. ë§¨ ì²˜ìŒ ë§Œë“  proxyê°€ root proxyì´ê¸° ë•Œë¬¸ì—
ë‚˜ì¤‘ì— rootProxyë¥¼ íšë“í•  ë•Œ <code>scope.drafts_[0]</code>ë¥¼ ì°¸ì¡°í•  ì˜ˆì •ì´ë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/v9.0.6/src/core/proxy.ts#L50-L95</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">createProxyProxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">base</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">...</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    scope_</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getCurrentScope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    modified_</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    finalized_</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    parent_</span><span class="token operator">:</span><span class="token plain"> parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    base_</span><span class="token operator">:</span><span class="token plain"> base</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    draft_</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    copy_</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">...</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> target </span><span class="token operator">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> traps </span><span class="token operator">=</span><span class="token plain"> objectTraps</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> revoke</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> proxy </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">revocable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">target</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> traps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">draft_ </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">revoke_ </span><span class="token operator">=</span><span class="token plain"> revoke</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p><code>createProxyProxy</code>ì—ì„œëŠ” immer ë™ì‘ì— ì‚¬ìš©í•  ì—¬ëŸ¬ ë©”íƒ€ ë°ì´í„°ë“¤ê³¼ ìƒˆ <code>Proxy</code>ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
immerì—ì„œ ì“°ì´ëŠ” ë©”íƒ€ë°ì´í„°ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ë¦¬ëœë‹¤.</p><ul><li><code>base_</code>: ê¸°ì¡´ data. produceì—ì„œ ì²«ë²ˆì§¸ ì¸ìë¡œ ë“¤ì–´ì™”ìœ¼ë©° ë³€ê²½ë˜ê¸° ì´ì „ ì›ë³¸ ë°ì´í„°ë¥¼ ì—¬ê¸°ì— ì €ì¥í•œë‹¤.</li><li><code>copy_</code>: ì—…ë°ì´íŠ¸ ëœ data. ì›ë³¸ ë°ì´í„°ì™€ <code>recipe</code>ë¥¼ ì´ìš©í•´ì„œ ì—…ë°ì´íŠ¸ ëœ ë°ì´í„°ë¥¼ ì—¬ê¸°ì— ì €ì¥í•œë‹¤. ì•„ì§ì€ ì•„ë¬´ ë°ì´í„°ë„ ì €ì¥ë˜ì–´ ìˆì§€ ì•Šë‹¤.</li><li><code>draft_</code>: <code>draft_</code> ëŠ” ì—¬ê¸°ì„œ ìƒì„±ë˜ëŠ” <code>Proxy</code> ê°ì²´ë¥¼ ì €ì¥í•œë‹¤. ì•ìœ¼ë¡œì˜ ë¡œì§ì—ì„œ <code>draft_.base_</code>ë‚˜ <code>draft_.copy_</code>ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì°¸ì¡°í•˜ê²Œ ëœë‹¤.</li><li><code>modified_</code>: ê°ì²´ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ì €ì¥í•œë‹¤. ê¸°ë³¸ ê°’ì€ ê°ì²´ê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ <code>false</code> ì´ë‹¤.</li><li><code>finalized_</code>: proxyê°€ ì—…ë°ì´íŠ¸ê°€ ì™„ë£Œë˜ì–´ return ë  ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€ë¥¼ ì €ì¥í•œë‹¤. ê¸°ë³¸ ê°’ì€ ê°ì²´ê°€ ì¤€ë¹„ ì¤‘ì´ë¯€ë¡œ <code>false</code> ì´ë‹¤. </li><li><code>parent_</code>: ê°ì²´ëŠ” multi depthë¡œ êµ¬ì„±ë  ìˆ˜ ìˆë‹¤. ë§Œì•½ ê°ì²´ê°€ íŠ¸ë¦¬ í˜•íƒœë¡œ êµ¬ì„±ëœë‹¤ë©´ ë¶€ëª¨ ê°ì²´ë¥¼ ì´ ê³³ì— ì €ì¥í•˜ê²Œ ëœë‹¤. root proxyì—ì„œëŠ” ë¶€ëª¨ê°€ ì—†ë‹¤.</li></ul><p>ì£¼ìš” ë©”íƒ€ë°ì´í„°ë“¤ì€ ìœ„ì—ì„œ ì •ë¦¬í•œ ì •ë„ì´ë‹¤. ë©”íƒ€ ë°ì´í„°ì˜ ê¸°ë³¸ ê°’ì„ ì„¤ì •í•˜ê³  <code>Proxy.revocable</code>ê³¼ <code>traps</code>ë¥¼ ì´ìš©í•´ì„œ Proxy ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. Proxyì— ëŒ€í•´ì„œëŠ” ë‹¤ìŒ ì±•í„°ì—ì„œ ì•Œì•„ë³´ì.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ìš©ì–´ ì •ë¦¬</h5></div><div class="admonition-content"><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="proxy-proxy"></a>proxy? Proxy?<a class="hash-link" href="#proxy-proxy" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h3><p>ì•ìœ¼ë¡œ immerì—ì„œ meta ë°ì´í„°ë¥¼ í¬í•¨í•´ì„œ <code>new Proxy</code> ê°ì²´ë¥¼ í¬í•¨í•˜ëŠ” ë³€ìˆ˜ <code>proxy</code>ë¥¼ ì–¸ê¸‰í•˜ê¸°ë„ í•˜ê³ ,
ìš©ì–´ ê·¸ëŒ€ë¡œ Javascriptì—ì„œ objectì— ëŒ€í•œ ì—¬ëŸ¬ ê¸°ë³¸ ë™ì‘ì„ ì œì–´í•˜ê¸° ìœ„í•œ ê°ì²´ <code>Proxy</code>ë¥¼ ì–¸ê¸‰í•˜ê¸°ë„ í•  ì˜ˆì •ì´ë‹¤.
ê³µêµë¡­ê²Œë„ ë‘ ìš©ì–´ê°€ &quot;í”„ë¡ì‹œ&quot; ë¡œ ë™ì¼í•œ ìš©ì–´ì´ê¸° ë•Œë¬¸ì— ì´ ê¸€ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ <code>p</code> ëŒ€, ì†Œë¬¸ì ìœ ë¬´ë¡œ êµ¬ë¶„í•´ì„œ ì‚¬ìš©í•  ì˜ˆì •ì´ë‹¤.</p><ul><li><code>proxy</code>: immerì—ì„œ ìƒì„±í•œ ë©”íƒ€ ë°ì´í„°ì™€ <code>new Proxy</code>ë¡œ ìƒì„±í•œ draftë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ê°ì²´.</li><li><code>Proxy</code>: javascriptì—ì„œ ì œê³µí•˜ëŠ” built-in ê°ì²´. Objectì˜ ì—¬ëŸ¬ ê¸°ë³¸ ë™ì‘ì„ ì œì–´í•˜ê¸° ìœ„í•œ ê°ì²´ë¡œ ì“°ì¸ë‹¤.</li></ul></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="new-proxy"></a>new Proxy<a class="hash-link" href="#new-proxy" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h3><p><strong><em>ì´ë²ˆ ì±•í„°ì—ì„œëŠ” <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener noreferrer">new Proxy</a>ê°€
ì–´ë–¤ ê²ƒì¸ì§€ ì•Œì•„ë³´ëŠ” ì‹œê°„ì„ ê°€ì§ˆ ê²ƒì´ë‹¤. Proxyì— ëŒ€í•´ ìµìˆ™í•˜ë‹¤ë©´ <a href="#traps-of-immer">ë‹¤ìŒ ì±•í„°ë¡œ ë„˜ì–´ê°€ë„ ë¬´ê´€í•˜ë‹¤</a>.</em></strong></p><p>ìš°ë¦¬ëŠ” ì´ì „ ì±•í„°ì—ì„œ <code>Proxy.revocable</code> ì„ ì´ìš©í•´ì„œ Proxy ê°ì²´ë¥¼ ë§Œë“¤ì—ˆë‹¤.</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener noreferrer">MDN ë¬¸ì„œ</a>ì—ì„œ Proxyì— ëŒ€í•´ ì •ì˜í•œ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><blockquote><p>The Proxy object enables you to create a proxy for another object, which can intercept and redefine fundamental operations for that object.</p></blockquote><p>Proxy ê°ì²´ëŠ” objectì˜ ê¸°ëŠ¥, setê³¼ getê³¼ ê°™ì€ ê¸°ëŠ¥ë“¤ì„ interceptí•˜ê±°ë‚˜ redefineì„ í•˜ëŠ” ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
immerì—ì„œëŠ” ì›ë³¸ ê°ì²´ë¡œ Proxy ê°ì²´ë¥¼ ë§Œë“¤ì–´ ì›ë³¸ ê°ì²´ë¥¼ get, setí•  ë•Œ ì§ì ‘ì ìœ¼ë¡œ ê°ì²´ë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¥¼ í•˜ê²Œë” ë¡œì§ì„
interceptí•˜ëŠ”ë° Proxyë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤.</p><p>ì˜ˆë¥¼ë“¤ì–´ì„œ Objectê°€ ìˆê³  setì„ í• ë•Œ ì„¤ì •í•œ ê°’ì„ 2ë°°ë¡œ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•˜ë©´ ëœë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> origin </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> handler </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">set</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">target</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> prop</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">typeof</span><span class="token plain"> value </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;number&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      target</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> value </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token known-class-name class-name">Reflect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">...</span><span class="token plain">arguments</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> proxy </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">Proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">origin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> handler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">b </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// 20</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// {}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p><code>proxy.a</code>ì— í• ë‹¹í•  ë•Œ ì¼ë°˜ ê°ì²´ì˜ setì„ ì‚¬ìš©í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ <code>Proxy</code> ê°ì²´ë¥¼ ë§Œë“¤ë•Œ ë“±ë¡í–ˆë˜ <code>handler.set</code>ì˜ ë¡œì§ì„ ë”°ë¥´ê²Œ ëœë‹¤.
setí•˜ëŠ” valueê°€ 10ì´ê¸° ë•Œë¬¸ì— <code>proxy.a</code> ì—ëŠ” 10ì´ ì•„ë‹Œ 20ì´ ì €ì¥ëœë‹¤. valueê°€ numberê°€ ì•„ë‹ë•Œì˜ ë™ì‘ì—ì„œ ì“°ì´ëŠ” <code>Reflect</code> ëŠ” ê¸°ì¡´ ë¡œì§ì„ ë”°ë¥´ê²Œ í•  ë•Œ ì‚¬ìš©í•œë‹¤.</p><p>ì, ë§Œì•½ì— <code>proxy.b</code> ê°ì²´ì— ì¶”ê°€ë¡œ ê°’ì„ í• ë‹¹í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ? <code>handler.set</code>ì´ ì‚¬ìš©ë˜ì–´ 40ì´ í• ë‹¹ë ê¹Œ? ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ 20ì´ í• ë‹¹ë ê¹Œ?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">c </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// 20? 40?</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>ì •ë‹µì€ 20ì´ë‹¤. ê·¸ ì´ìœ ëŠ” <code>proxy</code>ëŠ” Proxy ê°ì²´ì´ì§€ë§Œ, <code>proxy.b</code>ëŠ” Proxy ê°ì²´ê°€ ì•„ë‹ˆë¼ ì¼ë°˜ ê°ì²´ì´ê¸° ë•Œë¬¸ì´ë‹¤.
ë”°ë¼ì„œ <code>handler.set</code>ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì¼ë°˜ ê°ì²´ì˜ setì„ ì‚¬ìš©í•˜ì—¬ ê·¸ëŒ€ë¡œ 20ì„ í• ë‹¹í•˜ê³  ìˆëŠ” ê²ƒì´ë‹¤.</p><p>ì´ëŸ¬í•œ ë™ì‘ì€ immerì—ì„œ criticalí•˜ê²Œ ì‘ìš©ëœë‹¤. ê°ì²´ë¥¼ ë³€ê²½í•˜ëŠ” ê³¼ì •ì—ì„œ ëª‡ depthê°€ ë˜ëŠ” ìì‹ ê°ì²´ë¥¼ ë°”ë¡œ ë³€ê²½í•˜ëŠ” ì¼€ì´ìŠ¤ê°€ ë§ì„ ê²ƒì´ê¸° ë•Œë¬¸ì´ë‹¤. </p><p>ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì´ë¥¼ ëŒ€ì‘í•œë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> origin </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> handler </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">set</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">target</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> prop</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">typeof</span><span class="token plain"> value </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;number&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      target</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> value </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token known-class-name class-name">Reflect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">...</span><span class="token plain">arguments</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">get</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">target</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">typeof</span><span class="token plain"> target</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;object&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">Proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">target</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> handler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token known-class-name class-name">Reflect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">...</span><span class="token plain">arguments</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> proxy </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">Proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">origin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> handler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">b </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">c </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">d </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Proxy {}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:rgb(189, 147, 249)">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// 40</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>Proxyë¥¼ ë§Œë“¤ë•Œ setë¿ ì•„ë‹ˆë¼ getì—ì„œë„ ì»¤ìŠ¤í…€ ë¡œì§ì„ ì¶”ê°€í•œë‹¤. Proxy ê°ì²´ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¬ ë•Œ ì¼ë°˜ ê°ì²´ë¥¼ ê°€ì ¸ì˜¨ë‹¤ë©´ Proxy ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ê°€ì ¸ì˜¤ê²Œë” í•˜ëŠ” ê²ƒì´ë‹¤.
ì´ë ‡ê²Œ ë˜ë©´, <code>proxy</code> ê°ì²´ë„ Proxy ê°ì²´ì´ê³ , <code>proxy.b</code>ë„ <code>handler.get</code>ì„ ì‚¬ìš©í•´ì„œ ì¼ë°˜ê°ì²´ê°€ ì•„ë‹Œ Proxyê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.
ë”°ë¼ì„œ <code>proxy.b.c</code>ì— 20ì„ í• ë‹¹í•œë‹¤ë©´, <code>proxy.b</code>ëŠ” Proxy ê°ì²´ì´ë¯€ë¡œ <code>handle.set</code> ë¡œì§ì„ ì‚¬ìš©í•˜ì—¬ <code>proxy.b.c</code>ì—ëŠ” 20ì´ ì•„ë‹Œ 40ì´ í• ë‹¹ë˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.</p><p>ì´ëŸ¬í•œ getê³¼ setì˜ ë™ì‘ì„ ì´ìš©í•´ì„œ immerì—ì„œëŠ” getì—ì„œëŠ” ê¹Šìˆ™í•œ ê°ì²´ë¥¼ ì°¸ì¡°í• ë•Œì—ë„ Proxyë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œë”,
setì—ì„œëŠ” ê°ì²´ë¥¼ ì§ì ‘ ë³€ê²½í•˜ì§€ ì•Šê³  <code>base_</code>ì™€ <code>copy_</code>ë¥¼ ì´ìš©í•˜ëŠ” ë¡œì§ì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤. ë‹¤ìŒ ì±•í„°ì—ì„œ ì–´ë–»ê²Œ êµ¬í˜„ë˜ì–´ ìˆëŠ”ì§€ ì•Œì•„ë³´ì.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span><code>latest</code>ì™€ <code>peek</code>ì— ëŒ€í•´ì„œ</h5></div><div class="admonition-content"><p>ì•ìœ¼ë¡œì˜ immerì½”ë“œì—ì„œ immerì—ì„œ ì“°ì´ëŠ” ìœ í‹¸ í•¨ìˆ˜ì¸ <code>latest</code>ì™€ <code>peek</code>ì— ëŒ€í•´ì„œ ë§ì´ í™•ì¸í•˜ê²Œ ë  ê²ƒ ì´ë‹¤.
ì´ ìœ í‹¸ í•¨ìˆ˜ê°€ ì–´ë–¤ ë™ì‘ì„ í•˜ëŠ”ì§€ ê¶ê¸ˆí•˜ë‹¤ë©´ ì‚´í´ë³´ì.</p><ul><li>latest</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/master/src/utils/common.ts#L160-L162</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">latest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">copy_ </span><span class="token operator">||</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">base_</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>stateëŠ” produceì—ì„œ ìƒì„±í•œ proxy ê°ì²´ì´ë‹¤. proxy ê°ì²´ëŠ” meta dataì™€ <code>new Proxy</code>ë¡œ ìƒì„±í•œ ê°ì²´ë¥¼ ê°€ì§€ê³  ìˆë‹¤.
<code>latest</code>ëŠ” <code>copy_</code> í˜¹ì€ <code>base_</code> ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë°, í˜„ì¬ proxyê°€ ê°€ì§€ê³  ìˆëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì“°ì´ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.
<code>copy_</code>ëŠ” ë³€ê²½ëœ ìµœì‹  ê°ì²´ì´ê³ , <code>base_</code>ëŠ” ì›ë³¸ ê°ì²´ì´ë¯€ë¡œ <code>copy_</code>ë¥¼ ë¨¼ì € ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ìš°ì„ ì‹œí•˜ê³  ìˆë‹¤.</p><ul><li>peek</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/master/src/core/proxy.ts#L234-L238</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">peek</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">draft</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> state </span><span class="token operator">=</span><span class="token plain"> draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token constant" style="color:rgb(189, 147, 249)">DRAFT_STATE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> source </span><span class="token operator">=</span><span class="token plain"> state </span><span class="token operator">?</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">latest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> draft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p><code>peek</code>ëŠ” ê°ì²´ì—ì„œ íŠ¹ì • keyì— ëŒ€í•œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ì—­í• ì„ í•œë‹¤. ì¦‰, draftì—ì„œ propë¥¼ keyë¡œ ê°€ì§€ëŠ” ê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
ì—¬ê¸°ì„œëŠ” 3ê°€ì§€ ê²½ìš°ê°€ ì¡´ì¬í•œë‹¤.</p><ol><li>draftê°€ Proxyê°ì²´ê°€ ì•„ë‹ˆë¼ ì¼ë°˜ ê°ì²´ì¸ ê²½ìš° <br><ul><li>ì´ ê²½ìš°ëŠ” <code>draft[DRAFT_STATE]</code>ê°€ <code>undefined</code> ì´ê¸° ë•Œë¬¸ì— draft[prop] ë¥¼ ì°¸ì¡°í•´ì„œ ë°”ë¡œ ë¦¬í„´í•œë‹¤.</li></ul></li><li>draftê°€ Proxy ê°ì²´ì´ê³  <code>copy_</code> ë¥¼ ê°–ê³  ìˆì„ ê²½ìš°<ul><li><code>copy_.[prop]</code>ë¥¼ ë¦¬í„´í•œë‹¤.</li></ul></li><li>draftê°€ Proxy ê°ì²´ì´ê³  <code>copy_</code> ë¥¼ ê°–ê³  ìˆì§€ ì•Šì€ ê²½ìš°<ul><li><code>base_.[prop]</code>ë¥¼ ë¦¬í„´í•œë‹¤.</li></ul></li></ol><p>ì¦‰, ì—¬ëŸ¬ ê²½ìš°ì— ëŒ€í•´ì„œ object(í˜¹ì€, proxy)ì—ì„œ keyì— ë§ëŠ” ê°’ì„ êµ¬í•˜ê¸° ìœ„í•œ ìœ í‹¸ í•¨ìˆ˜ ì¸ ê²ƒì´ë‹¤.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="traps-of-immer"></a>Traps of immer<a class="hash-link" href="#traps-of-immer" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h3><p>immerì˜ <code>Proxy</code>ì—ì„œ ì‚¬ìš©ë˜ëŠ” getì€ multi depthì˜ ê°ì²´ë¥¼ ì°¸ì¡°í–ˆì„ë•Œì—ë„ Proxyë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ Proxyë¥¼ ìƒì„±í•´ì£¼ëŠ” ì—­í• ì„ ê°€ì§€ê³  ìˆê³ ,
setì€ ì›ë³¸ ê°ì²´ë¥¼ ë³€ê²½í•˜ë ¤ í•  ë•Œ ì´ë¥¼ ë§‰ê³  <code>base_</code>, <code>copy_</code>, <code>modified_</code>ì™€ ê°™ì€ ë©”íƒ€ ë°ì´í„°ë¥¼ ì œì–´í•˜ë„ë¡ í•˜ëŠ” ì—­í• ì„ ê°€ì§€ê³  ìˆë‹¤.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="get"></a>Get<a class="hash-link" href="#get" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h4><p>get ë¡œì§ì˜ ëª©ì ì€ deepí•œ treeì— ì ‘ê·¼í•˜ì—¬ setì„ í•˜ë”ë¼ë„ proxyê°ì²´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒì´ë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/master/src/core/proxy.ts#L101-L124</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> objecTraps </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">prop </span><span class="token operator">===</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">DRAFT_STATE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> source </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">latest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> value </span><span class="token operator">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">props</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">finalized_ </span><span class="token operator">||</span><span class="token plain"> </span><span class="token operator">!</span><span class="token function" style="color:rgb(80, 250, 123)">isDraftable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> value    </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value </span><span class="token operator">===</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">peek</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">base_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token function" style="color:rgb(80, 250, 123)">prepareCopy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">copy_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">createProxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">scope_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">immer_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> value</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">prop </span><span class="token operator">===</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">DRAFT_STATE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>ê°€ì¥ ë¨¼ì € ë³´ì´ëŠ” DRAFT_STATE ë¹„êµ ë¡œì§ì€ immerì—ì„œ draftë¥¼ ë°”ë¡œ íšë“í•˜ê¸°ìœ„í•œ holeê°™ì€ ë™ì‘ìœ¼ë¡œ ë³´ì¸ë‹¤.
<code>peek</code> ì™€ ê°™ì€ ìœ í‹¸í•¨ìˆ˜ì—ì„œ proxyê°ì²´ì—ì„œ <code>draft[DRAFT_STATE]</code>ë¥¼ í˜¸ì¶œí•´ì„œ proxy ê·¸ ìì²´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> source </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">latest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> value </span><span class="token operator">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">finalized_ </span><span class="token operator">||</span><span class="token plain"> </span><span class="token operator">!</span><span class="token function" style="color:rgb(80, 250, 123)">isDraftable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> value  </span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>ë‹¤ìŒ ë¡œì§ì€, proxy ê°ì²´ë¥¼ ë§Œë“¤ í•„ìš”ê°€ ì—†ëŠ” ê²½ìš°ì— ëŒ€í•œ ë¶„ê¸°ì´ë‹¤.
stateê°€ <code>finalized</code> ìƒíƒœ, ì¦‰ ë°ì´í„°ê°€ ëª¨ë‘ ì—…ë°ì´íŠ¸ ë˜ì–´ returní•  ì¤€ë¹„ê°€ ëœ ìƒíƒœë¼ë©´ proxyë¡œ ë³€ê²½í•  í•„ìš”ê°€ ì—†ê³ ,
valueê°€ <code>isDraftable</code>, ì¦‰ mutableí•œ ì†ì„±ì„ ê°€ì§€ëŠ” objectë‚˜ array ê°™ì€ íƒ€ì…ì´ ì•„ë‹Œ ê²½ìš°ëŠ” proxyë¡œ ë§Œë“¤ ì´ìœ ê°€ ì—†ìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ë¦¬í„´ì„ í•œë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value </span><span class="token operator">===</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">peek</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">base_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">prepareCopy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">copy_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">createProxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">scope_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">immer_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> value</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>ì´ì œëŠ” proxy ê°ì²´ë¥¼ ë§Œë“¤ë•Œì˜ ë¡œì§ì´ë‹¤. <code>prepareCopy</code> ë¥¼ í˜¸ì¶œí•˜ê³  <code>copy_</code>ì— ìì‹ proxyë¥¼ ìƒì„±í•œë‹¤.
<code>prepareCopy</code>ëŠ” <code>state.base_</code>ë¥¼ <code>state.copy_</code>ë¡œ shallow copyë¥¼ í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
<code>state.copy_</code>ë¥¼ ë³µì‚¬í•´ì„œ ë§Œë“¤ê³ , <code>state.copy_[prop]</code>ì— ìƒˆë¡œìš´ proxyë¥¼ ìƒì„±í•˜ì—¬ ì €ì¥í•œë‹¤.
ì´ë•Œë¶€í„° <code>base_</code>ì™€ <code>copy_</code>ê°€ ê°€ì§€ê³  ìˆëŠ” ê°’ë“¤ì´ ê°™ì§€ ì•Šê²Œ ëœë‹¤. </p><p>ì´ëŸ¬í•œ ë¡œì§ì„ í†µí•´ì„œ deep treeë¥¼ ì°¸ì¡°í•˜ë”ë¼ë„ ê°ì²´ì¸ ê²½ìš° proxyë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•´ë†“ì•˜ë‹¤.</p><p>ì ê·¸ë ‡ë‹¤ë©´, í•œë²ˆ getìœ¼ë¡œ proxyë¥¼ ë§Œë“  ê°ì²´ë¥¼ ë‹¤ì‹œ ì°¸ì¡°í•˜ë©´ ë‹¤ì‹œ proxy ê°ì²´ë¥¼ ë§Œë“¤ê¹Œ?
ë‹¹ì—°í•œ ë§ì´ì§€ë§Œ í•œë²ˆ proxyë¥¼ ë§Œë“  ê°ì²´ë¼ë©´ ê¸°ì¡´ì— ë§Œë“¤ì–´ ë‘” ê²ƒì„ ì¬ì‚¬ìš©í•œë‹¤.
ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê²Œë” ê²€ì‚¬ë¥¼ í•˜ëŠ” ë¡œì§ì´  <code>value === peek(state.base_, prop)</code> ì˜ ë¶„ê¸°ì´ë‹¤.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithHideOnScrollNavbar_3R7-" id="ì´ë¯¸-ìƒì„±í•œ-proxyì˜-ì¬ì‚¬ìš©-value--peekstatebase_-prop"></a>ì´ë¯¸ ìƒì„±í•œ proxyì˜ ì¬ì‚¬ìš© (<code>value === peek(state.base_, prop)</code>)<a class="hash-link" href="#ì´ë¯¸-ìƒì„±í•œ-proxyì˜-ì¬ì‚¬ìš©-value--peekstatebase_-prop" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h5><p><code>peek(state.base_, prop)</code>ëŠ” <code>base_</code>ì˜ propë¥¼ ì˜ë¯¸í•˜ê³ , <code>value</code>ëŠ” <code>copy_</code> í˜¹ì€ <code>base_</code>ì˜ propë¥¼ ì˜ë¯¸í•œë‹¤.
<code>copy_</code>ê°€ ìƒì„±ë˜ê¸° ì „, ì¦‰ getì„ í•œ ì ì´ ì—†ë‹¤ë©´ í•­ìƒ <code>base_</code>ì™€ <code>base_</code>ë¥¼ ë¹„êµí•˜ë¯€ë¡œ í•­ìƒ trueì´ê³  proxyë¥¼ ë§Œë“œëŠ” ë¡œì§ì„ í•­ìƒ ì‹¤í–‰ í•  ê²ƒì´ë‹¤.
í•˜ì§€ë§Œ, getì„ í•œ ì ì´ ìˆê³  <code>copy_</code>ê°€ ë§Œë“¤ì–´ì§„ ìƒíƒœë¼ë©´ <code>copy_</code> ì™€ <code>base_</code>ë¥¼ ë¹„êµí•œë‹¤.
ì´ì „ getë¡œì§ì—ì„œ <code>copy_[prop]</code>ì— proxyë¥¼ í• ë‹¹í•˜ì—¬ ì´ë¯¸ <code>base_</code>ì™€ ê°’ì´ ë‹¬ë¼ì¡Œê¸° ë•Œë¬¸ì— proxyë¥¼ ë§Œë“œëŠ” ë¡œì§ì„ ìŠ¤í‚µí•˜ê³  ê·¸ëŒ€ë¡œ <code>state.copy_</code>ë¥¼ ë¦¬í„´í•œë‹¤.
ì´ëŸ¬í•œ ë°©ì‹ì„ ì‚¬ìš©í•´ì„œ getì—ì„œ ë¶ˆí•„ìš”í•˜ê²Œ proxyë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê³  ìˆë‹¤.</p><p>ì½”ë“œë¡œ í•œì¤„ì”© ì„¤ëª…í•˜ë‹ˆ ë³µì¡í•œë°, proxyì˜ getë™ì‘ì—ì„œ í•˜ëŠ” ì¼ì„ ìš”ì•½í•´ë³´ì.</p><ol><li>ê°ì²´ì—ì„œ ì°¸ì¡°í•˜ëŠ” ê°’ì´ objectê°€ ì•„ë‹Œ ê²½ìš° ê·¸ëŒ€ë¡œ ê°’ì„ ë¦¬í„´í•œë‹¤.</li><li>ê°ì²´ì—ì„œ ì°¸ì¡°í•˜ëŠ” ê°’ì´ objectì¼ ê²½ìš° proxyë¥¼ ë§Œë“¤ì–´ì„œ ë¦¬í„´í•œë‹¤.</li><li>ë§Œì•½ í•œë²ˆ ì°¸ì¡°í•œ ì ì´ ìˆëŠ” objectë¼ë©´ ì´ì „ì— ë§Œë“¤ì–´ë‘” proxyë¥¼ ì¬ì‚¬ìš©í•œë‹¤.</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="set"></a>Set<a class="hash-link" href="#set" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h4><p>set ë¡œì§ì˜ ëª©ì ì€ ê°ì²´ë¥¼ ë³€ê²½í•˜ê³  ê°ì²´ê°€ ë³€ê²½ë˜ì—ˆë‹¤ëŠ” <code>modified_</code> flagë¥¼ ì„¤ì •í•˜ëŠ” ëª©ì ì„ ê°€ì§„ë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/master/src/core/proxy.ts#L131-L173</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> objectTraps </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">modified_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> current </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">peek</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">latest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> currentState </span><span class="token operator">=</span><span class="token plain"> current</span><span class="token operator">?.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token constant" style="color:rgb(189, 147, 249)">DRAFT_STATE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">is</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> current</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">has</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">base_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token function" style="color:rgb(80, 250, 123)">prepareCopy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token function" style="color:rgb(80, 250, 123)">markChanged</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">copy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">props</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">copy_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">props</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>setì—ì„œ ì‚¬ìš©í•˜ëŠ” ì£¼ìš” ë¡œì§ì„ ì¶•ì•½í•˜ë©´ ìœ„ì™€ ê°™ë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">...</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">copy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">props</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">copy_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">props</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p><code>modified_</code> ì—¬ë¶€ì— ê´€ê³„ì—†ì´ ì§„í–‰í•˜ëŠ” ë¡œì§ì„ ë³´ë©´ setì„ í•  ë•Œ original data(<code>base_</code>)ë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  <code>copy_</code>ë§Œì„ ë³€ê²½ì‹œí‚¤ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.
ì´ ê³¼ì •ì—ì„œ ìƒˆë¡œìš´ ê°’ì´ <code>copy_</code>ì— ì €ì¥ë˜ì–´ ìˆëŠ” ê°’ê³¼ referenceê°€ ê°™ë‹¤ë©´ ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ë¡œì¨ ë¶ˆí•„ìš”í•œ ì—…ë°ì´íŠ¸ëŠ” ë°©ì§€í•˜ê³  ìˆëŠ” ê²ƒë„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.</p><p>ë§Œì•½, ì—…ë°ì´íŠ¸ ë  ê°ì²´ê°€ ë³€ê²½ëœ ì´ë ¥ì´ ì—†ë‹¤ë©´ <code>modified_</code>ê°€ falseì¼ í…ë°, set ë¡œì§ì—ì„œ <code>modified_</code> flagê°€ ë³€ê²½ëœë‹¤. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">modified_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> current </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">peek</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">latest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> currentState </span><span class="token operator">=</span><span class="token plain"> current</span><span class="token operator">?.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token constant" style="color:rgb(189, 147, 249)">DRAFT_STATE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">is</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> current</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">has</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">base_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">prepareCopy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">markChanged</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">...</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>setì„ ì§„í–‰í•  ë•Œ <code>modified</code>ê°€ false ìƒíƒœë¼ë©´ ë³€ê²½ ë¡œì§ì„ ì§„í–‰í•œë‹¤. edgeë¡œì§ì„ ì œì™¸í•˜ê³  ê¸°ë³¸ë¡œì§ë§Œ ë³¸ë‹¤ë©´ <code>prepareCopy</code>ì™€ <code>markChanged</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="getì—ì„œì˜-preparecopyì™€-setì—ì„œì˜-preparecopy"></a>getì—ì„œì˜ <code>prepareCopy</code>ì™€ setì—ì„œì˜ <code>prepareCopy</code><a class="hash-link" href="#getì—ì„œì˜-preparecopyì™€-setì—ì„œì˜-preparecopy" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h4><p>ì´ì „ì— getì„ ì§„í–‰í•  ë•Œ <code>prepareCopy</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” ê±¸ ë³´ì•˜ë‹¤. getí• ë•Œ copyë¥¼ ì§„í–‰í•˜ê³  setí• ë•Œë„ copyë¥¼ ì§„í–‰í•˜ëŠ”ê±¸ê¹Œ?</p><p>ìì„¸íˆë³´ë©´ getì˜ <code>prepareCopy</code>ì™€ setì˜ <code>prepareCopy</code>ëŠ” ëª©ì ì´ ë‹¤ë¥´ë‹¤.
getì˜ <code>prepareCopy</code>ëŠ” ì°¸ì¡°í•  ê°ì²´ì˜ ë¶€ëª¨ê°ì²´ë¥¼ copyí•˜ëŠ” ë™ì‘ì„ í•˜ê³ , setì˜ <code>prepareCopy</code>ëŠ” ì°¸ì¡°í•˜ëŠ” ê°ì²´ ë³¸ì¸ë¥¼ copyí•˜ëŠ” ë™ì‘ì„ í•œë‹¤.
ì˜ˆë¥¼ë“¤ì–´, ë§Œì•½ <code>proxy.a.b = { ... }</code>ë¡œ ê°ì²´ë¥¼ ë³€ê²½í•œë‹¤ë©´ <code>proxy.a</code> ê¹Œì§€ëŠ” getì—ì„œ <code>prepareCopy</code>ë¥¼ í†µí•´ <code>copy_</code>ë¥¼ ë§Œë“¤ê³ ,
<code>proxy.a.b</code>ëŠ” setì—ì„œ <code>prepareCopy</code>ë¥¼ í†µí•´ <code>copy_</code>ë¥¼ ë§Œë“ ë‹¤.</p></div></div><p><code>markChanged</code>ì˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/v9.0.6/src/core/proxy.ts#L266-L273</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">markChanged</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">state</span><span class="token parameter operator">:</span><span class="token parameter"> ImmerState</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">modified_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">modified_ </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">parent_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token function" style="color:rgb(80, 250, 123)">markChanged</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">parent_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>ë³¸ì¸ì˜ <code>modified_</code>ë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒê³¼ ë”ë¶ˆì–´ ë¶€ëª¨ê°ì²´ì˜ <code>modified_</code>ë¥¼ í†µí•´ root proxyê¹Œì§€ì˜ <code>modified_</code>ë¥¼ ë³€ê²½í•œë‹¤.
ì´ë ‡ê²Œ root proxyê¹Œì§€ ë³€ê²½í•¨ìœ¼ë¡œì¨ rootë¶€í„° leafê¹Œì§€ ì–´ë–¤ ê°ì²´ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ë¥¼ ì°¾ì•„ ê°ˆ ìˆ˜ ìˆë‹¤.</p><p>ì¶”ê°€ë¡œ ì¤‘ê°„ì— ë¹ ëœ¨ë ¸ë˜ <code>modified</code> ë³€ê²½ì‹œì˜ edge caseë¥¼ í™•ì¸í•´ë³´ì.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">modified_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> current </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">peek</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">latest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> currentState </span><span class="token operator">=</span><span class="token plain"> current</span><span class="token operator">?.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token constant" style="color:rgb(189, 147, 249)">DRAFT_STATE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">is</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> current</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">has</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">base_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">prepareCopy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">markChanged</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">...</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>ë³€ê²½ ë  ê°’(value)ê³¼ ì €ì¥ë˜ì–´ ìˆëŠ” ê°’(current)ì´ ê°™ê³ , <code>base_[prop]</code>ê°€ ê°’ì´ ìˆë‹¤ë©´ ë³€ê²½ í•  í•„ìš”ê°€ ì—†ë‹¤ê³  íŒë‹¨í•˜ê³ 
<code>modified_</code>ë¥¼ trueë¡œ ë§Œë“œëŠ” ê³¼ì •ì„ ì¤‘ë‹¨í•˜ê³  ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ê°™ì€ ê°’ì„ í• ë‹¹í–ˆì„ë•Œ modified_ë¥¼ ë³€ê²½í•˜ì§€ ì•ŠìŒìœ¼ë¡œì¨
ë¶ˆí•„ìš”í•œ ì—°ì‚°ì„ ì¤„ì´ë ¤ëŠ” ë…¸ë ¥ìœ¼ë¡œ ë³´ì¸ë‹¤.</p><p>ì ì´ì œ setì˜ ë¡œì§ì„ ìš”ì•½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><ol><li><code>modified_</code>ê°€ falseë¼ë©´ ìì‹ ì˜ <code>copy_</code>ë¥¼ <code>base_</code>ì—ì„œ ë³µì‚¬í•´ì£¼ê³  ìì‹  í¬í•¨ ë¶€ëª¨ë¶€í„° ë£¨íŠ¸ê¹Œì§€ì˜ <code>modified_</code>ë¥¼ trueë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.</li><li>modified ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ <code>state.copy_</code>ì— ë³€ê²½í•  ê°’ì„ í• ë‹¹í•´ì¤€ë‹¤.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="recap-of-proxy"></a>Recap of Proxy<a class="hash-link" href="#recap-of-proxy" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h3><p>immerì—ì„œ Proxyê°ì²´ê°€ í•˜ëŠ” ì—­í• ì„ ì •ë¦¬í•´ë³´ì.</p><ul><li>ë°ì´í„°ë¥¼ ì°¸ì¡°í• ë•Œ ê°ì²´ë¼ë©´ Proxy ê°ì²´ë¥¼ ìƒì„±í•´ì¤€ë‹¤. ê°ì²´ì—ì„œ ì—¬ëŸ¬ë²ˆ multi depthë¡œ ì°¸ì¡°ë¥¼ í–ˆì„ë•Œ  getì€ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰ë˜ê¸° ë•Œë¬¸ì— root ê°ì²´ë¶€í„° target ê°ì²´ê¹Œì§€ í†µí•˜ëŠ” ëª¨ë“  ê°ì²´ê°€ proxyë¡œ ìƒì„±ë˜ê²Œ ëœë‹¤. ë•ë¶„ì— multi depthë¡œ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ì˜€ì„ë•Œë„ rootì™€ ë™ì¼í•œ Proxy ë¡œì§ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.</li><li>ë°ì´í„°ë¥¼ í• ë‹¹í• ë•Œì—ëŠ” <code>base_</code>ë¥¼ <code>copy_</code>ë¡œ ì–•ì€ ë³µì‚¬ë¥¼ í•˜ê³  <code>copy_</code> ê°ì²´ì— ë³€ê²½ë˜ëŠ” ê°’ì„ ì—…ë°ì´íŠ¸í•œë‹¤. ì´ë•Œ, ë³€ê²½ëœ ì  ì—†ëŠ” ê°ì²´ë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì´ë¼ë©´ í•´ë‹¹ ê°ì²´ë¶€í„° ë¶€ëª¨ ê°ì²´ë¥¼ ê±°ì³ root ê°ì²´ê¹Œì§€ modifiedë¥¼ ëª¨ë‘ trueë¡œ ì„¤ì •í•œë‹¤.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="finalize"></a>finalize<a class="hash-link" href="#finalize" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h2><p><code>recipe</code> í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ë°ì´í„°ë¥¼ ëª¨ë‘ ë³€ê²½í•˜ì˜€ë‹¤ë©´ ì´ì œ finalize ê³¼ì •ì„ ì§„í–‰í•œë‹¤. <code>base_</code>ì™€ <code>copy_</code>ë“¤ì„ ì ì ˆí•˜ê²Œ í•©ì³ì£¼ëŠ” ê³¼ì •ì¸ ê²ƒì´ë‹¤.
ë‹¤ì‹œ produce ì½”ë“œë¥¼ ë³´ìë©´ ë‹¤ìŒê³¼ ê°™ë‹¤. <br>
ì—¬ê¸°ì„œ <code>return processResult(result, scope)</code> ì— ëŒ€í•œ ë¡œì§ì„ í™•ì¸í•˜ëŠ” ê²ƒì´ë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/v9.0.6/src/core/immerClass.ts#L66-L122</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Immer</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  produce</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">base</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> recipe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> scope </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">enterScope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> proxy </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">createProxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">undefined</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">recipe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">processResult</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> scope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/v9.0.6/src/core/finalize.ts#L22-L56</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">processResult</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">result</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> scope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> baseDraft </span><span class="token operator">=</span><span class="token plain"> scope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">drafts_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> isReplaced </span><span class="token operator">=</span><span class="token plain"> result </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">undefined</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">isReplaced</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">finalize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">finalize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> baseDraft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p><code>finalize</code>ê³¼ì •ì€ í¬ê²Œ ë‘ê°€ì§€ë¡œ ë‚˜ë‰œë‹¤. <code>recipe</code>ì—ì„œ returnì„ í•˜ëŠ” ê²½ìš°ì™€ ì•„ë‹Œ ê²½ìš°ì´ë‹¤.
ì´ ë‘ê°€ì§€ì˜ ì°¨ì´ëŠ” <code>finalize</code> í•¨ìˆ˜ë¡œ ë„£ì–´ì£¼ëŠ” ë³€ìˆ˜ì— ìˆë‹¤. <code>recipe</code>ê°€ returnì„ í•˜ê³  ìˆë‹¤ë©´ resultê°’ì„ ê¸°ì¤€ìœ¼ë¡œ finalizeë¥¼ ì§„í–‰í•˜ê³ ,
<code>recipe</code>ê°€ returnì„ í•˜ì§€ ì•Šìœ¼ë©´ root proxyë¥¼ ê¸°ì¤€ìœ¼ë¡œ finalizeë¥¼ ì§„í–‰í•œë‹¤.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="root-proxyë¥¼-ì‚¬ìš©í•˜ëŠ”-finalize"></a>root proxyë¥¼ ì‚¬ìš©í•˜ëŠ” finalize<a class="hash-link" href="#root-proxyë¥¼-ì‚¬ìš©í•˜ëŠ”-finalize" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h3><p><code>recipe</code>ê°€ returnì„ í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ìë™ìœ¼ë¡œ root proxyë¥¼ ì‚¬ìš©í•´ì„œ finalizeë¥¼ ì§„í–‰í•œë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/v9.0.6/src/core/finalize.ts#L57-L110</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">finalize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">rootScope</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> value</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">...</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">modified_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">base_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">finalized_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">finalized_ </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">copy_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">each</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">key</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> childValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">finalizeProperty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">...</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">copy_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>ì—¬ê¸°ì„œ valueëŠ” root proxyë¥¼ ì˜ë¯¸í•œë‹¤. ë§Œì•½ root proxyê°€ <code>modified_</code>ë¥¼ falseë¡œ ê°–ê³ ìˆë‹¤ë©´ ë‚´ë¶€ ê°ì²´ëŠ” í•œë²ˆë„ ë³€ê²½ëœ ì ì´ ì—†ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.
ë”°ë¼ì„œ <code>state.base_</code>ë¥¼ ê·¸ëŒ€ë¡œ ë¦¬í„´í•œë‹¤. ë³€ê²½ëœ ì ì´ ìˆì–´ì„œ <code>modified_</code>ê°€ trueë¼ë©´  <code>finalized_</code>ë¥¼ í™•ì¸í•œë‹¤. finalizeë¥¼ ì—¬ëŸ¬ë²ˆ í•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•¨ì´ë©°,
finalized ë¡œì§ì„ ë“¤ì–´ê°€ë©´ <code>finalized_</code>ë¥¼ trueë¡œ ë³€ê²½í•˜ê³  ë¡œì§ì„ ì§„í–‰í•œë‹¤. proxyë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ES5 ëª¨ë“œë¼ë©´ ì—¬ëŸ¬ ë¡œì§ë“¤ì´ ì§„í–‰ë˜ì§€ë§Œ proxyëª¨ë“œë¼ë©´
<code>state.copy_</code>ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•œë‹¤. <code>each</code>ë¥¼ í¬í•¨í•œ <code>finalizeProperty</code>ëŠ” root proxy ë‚´ë¶€ì— ìˆëŠ” ìì‹ ê°ì²´ë“¤ì„ ëª¨ë‘ <code>finalize</code>í•˜ê¸° ìœ„í•œ ë™ì‘ì´ë‹¤.
ëª¨ë“  ìì‹ ê°ì²´ì˜ finalizeë¥¼ ì™„ë£Œí•˜ì˜€ë‹¤ë©´ <code>state.copy_</code>ë¥¼ ë¦¬í„´í•¨ìœ¼ë¡œì¨ immerë¡œì§ì´ ì¢…ë£Œëœë‹¤.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="recipeì˜-returnì„-ì‚¬ìš©í•˜ëŠ”-finalize"></a>recipeì˜ returnì„ ì‚¬ìš©í•˜ëŠ” finalize<a class="hash-link" href="#recipeì˜-returnì„-ì‚¬ìš©í•˜ëŠ”-finalize" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h3><p><code>recipe</code>ê°€ return ê°’ì„ ê°€ì§€ê³  ìˆë‹¤ë©´ return ê°’ì„ ì‚¬ìš©í•˜ì—¬ finalizeë¥¼ ì§„í–‰í•œë‹¤. ë¬¼ë¡  return ê°’ì€ plain objectì´ë‹¤.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// https://github.com/immerjs/immer/blob/v9.0.6/src/core/finalize.ts#L57-L110</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">finalize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">rootScope</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> value</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> state </span><span class="token operator">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token constant" style="color:rgb(189, 147, 249)">DRAFT_STATE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">each</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">key</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> childValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">finalizeProperty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">...</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">...</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" class="copyButton_Ue-o clean-btn">ë³µì‚¬</button></div></div><p>plain objectì¸ valueì—ì„œ <code>value[DRAFT_STATE]</code>ë¥¼ ì°¸ì¡°í•œë‹¤ë©´ undefinedì¼ ìˆ˜ ë°–ì— ì—†ë‹¤. ë”°ë¼ì„œ <code>if (!state)</code> ë¡œì§ìœ¼ë¡œ ì§„í–‰ëœë‹¤.
root proxyë¥¼ ì‚¬ìš©í•˜ëŠ” finalizeì™€ ë™ì¼í•˜ê²Œ <code>finalizeProperty</code>ë¥¼ í†µí•´ì„œ ìì‹ ê°ì²´ë“¤ì„ ëª¨ë‘ finalize ê³¼ì •ì„ ì§„í–‰í•œ ë’¤ valueë¥¼ ë¦¬í„´í•œë‹¤.</p><p>ì´ë•Œ, ìì‹ ê°ì²´ ëª¨ë‘ proxyê°ì²´ê°€ ì•„ë‹Œ plain objectë¼ê³  ìƒê°í•  ìˆ˜ ìˆëŠ”ë° <code>recipe</code> ë‚´ë¶€ì—ì„œ ì ‘ê·¼í•˜ëŠ” ê°ì²´ì˜ ê²½ìš° ëª¨ë‘ Proxyì˜ get ë™ì‘ì— ì˜í•´ì„œ
proxyë¡œ ë³€ê²½ë˜ì–´ ë¦¬í„´ë˜ê¸° ë•Œë¬¸ì— rootëŠ” proxyê°€ ì•„ë‹ˆë”ë¼ë„ ìì‹ ê°ì²´ëŠ” proxyì¼ ìˆ˜ë„ ìˆë‹¤. ë”°ë¼ì„œ ìì‹ ê°ì²´ê¹Œì§€ ëª¨ë‘ finalize ë¥¼ ì§„í–‰í•´ì£¼ì–´ì•¼í•œë‹¤.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="recap-1"></a>Recap<a class="hash-link" href="#recap-1" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h2><ul><li>immerëŠ” baseState ê°ì²´ì™€ recipe ì½œë°±í•¨ìˆ˜ë¥¼ ë°›ì•„ì„œ recipe ë‚´ë¶€ mutableí•œ ë¡œì§ë“¤ì„ ëª¨ë‘ ìˆ˜í–‰í•˜ëŠ”ë°, ê¸°ì¡´ ê°ì²´ëŠ” ë³€ê²½í•˜ì§€ ì•Šê³  ì—…ë°ì´íŠ¸ ëœ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì´ë‹¤.</li><li>immerëŠ” baseStateë¥¼ ë°›ìœ¼ë©´ ìš°ì„  baseStateë¥¼ Proxyê°ì²´ë¡œ ë§Œë“¤ì–´ì„œ ê´€ë¦¬í•œë‹¤.</li><li>proxy ê°ì²´ëŠ” ì—¬ëŸ¬ ê°’ì„ ê°–ê³ ìˆì§€ë§Œ <code>base_</code>ì™€ <code>copy_</code>ë‘ ê°ì²´ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ê´€ë¦¬í•˜ë©° <code>base_</code>ëŠ” original data, <code>copy_</code>ëŠ” updated dataë¡œì¨ ê´€ë¦¬í•œë‹¤.</li><li>ì•ì—ì„œ ë§Œë“  Proxy ê°ì²´ë¡œ recipe ì½œë°± í•¨ìˆ˜ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ”ë°, ì—¬ê¸°ì„œ mutableí•œ ë¡œì§ì„ mutableí•˜ì§€ ì•Šê²Œ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì€ Proxyì˜ setê³¼ get ë“± ê°ì²´ ê¸°ë³¸ ë™ì‘ë“¤ì„ interceptí•˜ê¸° ë•Œë¬¸ì´ë‹¤.</li><li>proxyì˜ getì—ì„œëŠ” ë§Œë‚˜ëŠ” ê°ì²´ë¥¼ ëª¨ë‘ Proxyë¡œ ë¦¬í„´í•˜ì—¬ ê°ì²´ ê¹Šìˆ™í•œ ê³³ì„ ì°¸ì¡°í•˜ë”ë¼ë„ Proxyë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ ë§Œë“ ë‹¤.</li><li>Proxyì˜ setì—ì„œëŠ” Proxyê°ì²´ ë‚´ë¶€ì—ì„œ ê´€ë¦¬í•˜ê³  ìˆëŠ” <code>modified_</code> flagë¥¼ ë³´ê³  ë³€ê²½ ì—¬ë¶€ë¥¼ ê´€ë¦¬í•˜ë©° <code>base_</code>ê°ì²´ê°€ ì•„ë‹Œ <code>copy_</code>ê°ì²´ë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.</li><li>immerì—ì„œ Proxyì˜ set, getì„ í™œìš©í•´ì„œ recipe ë¡œì§ì„ ëª¨ë‘ ìˆ˜í–‰í•˜ê³ ë‚˜ë©´ Proxyê°ì²´ì˜ ì •ë³´ë¥¼ ì´ìš©í•´ì„œ ë³€ê²½ëœ ê°ì²´ëŠ” ì—…ë°ì´íŠ¸ ëœ ê°ì²´(<code>copy_</code>)ë¥¼ ì‚¬ìš©í•˜ê³  ë³€ê²½ë˜ì§€ ì•Šì€ ê°ì²´ëŠ” ê¸°ì¡´ ê°ì²´(<code>base_</code>)ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ structuring shareë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ë¦¬í„´í•œë‹¤.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="ê¶ê¸ˆì¦-í•´ì†Œ"></a>ê¶ê¸ˆì¦ í•´ì†Œ<a class="hash-link" href="#ê¶ê¸ˆì¦-í•´ì†Œ" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h2><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Question</h5></div><div class="admonition-content"><p>Q1. <code>immer</code>ëŠ” mutableí•˜ê²Œ ê°ì²´ë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì„ ì–´ë–»ê²Œ immutableí•œ ë°©ì‹ìœ¼ë¡œ ë°”ê¾¸ì–´ì£¼ê³  ìˆì„ê¹Œ?</p></div></div><p>A1. <code>immer</code>ëŠ” <code>new Proxy</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ getê³¼ set ë¡œì§ì„ interceptí•˜ê¸° ë•Œë¬¸ì— ê°ì²´ë¥¼ mutableí•˜ê²Œ ë³€ê²½í•˜ë”ë¼ë„ ê°ì²´ê°€ ì§ì ‘ì ìœ¼ë¡œ ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤.
setë¡œì§ì—ì„œ <code>base_</code>ë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  <code>copy_</code>ë¡œ shallow copyí•˜ì—¬ <code>copy_</code> ê°ì²´ì— ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•œë‹¤.</p><p>ëª¨ë“  ì—…ë°ì´íŠ¸ê°€ ëë‚˜ë©´ ê°’ì„ ë¦¬í„´í• ë•Œ ê°ì²´ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ë¥¼ íŒë‹¨í•´ì„œ <code>copy_</code>í˜¹ì€ <code>base_</code>ë¥¼ ë¦¬í„´í•¨ìœ¼ë¡œì¨ ê°ì²´ë¥¼ immutableí•˜ê²Œ ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆë‹¤.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Question</h5></div><div class="admonition-content"><p>Q2. <code>immer</code>ëŠ” ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ structural sharingì„ ì‚¬ìš©í•˜ëŠ”ê°€?</p></div></div><p>A2. <code>immer</code>ëŠ” ê°ì²´ì˜ ë³€ê²½ì—¬ë¶€ì— ë”°ë¼ì„œ <code>modified_</code>ê°’ì„ ê´€ë¦¬í•œë‹¤. <code>modified_</code>ê°€ trueë¼ë©´ ê°ì²´ê°€ ì—…ë°ì´íŠ¸ ë˜ì—ˆë‹¤ëŠ” ê²ƒì´ë‹¤.
<code>modified_</code> ê°’ì„ ë³´ê³  trueë¼ë©´ <code>copy_</code>ë¼ëŠ” ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë¦¬í„´í•˜ì—¬ ìƒˆë¡œìš´ referenceë¥¼ ì‚¬ìš©í•˜ê³ ,
<code>modifed_</code>ê°€ falseë¼ë©´ <code>base_</code> ê°ì²´, ê¸°ì¡´ ê°ì²´ë¥¼ ë°˜í™˜í•¨ìœ¼ë¡œì¨ ê¸°ì¡´ referenceë¥¼ ì‚¬ìš©í•œë‹¤.
ë”°ë¼ì„œ ë³€ê²½ëœ ì—¬ë¶€ì— ëŒ€í•œ booleanì„ ê´€ë¦¬í•˜ê³  ê·¸ ì—¬ë¶€ì— ë”°ë¼ ê¸°ì¡´ ê²ƒì„ ì‚¬ìš©í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ê²ƒì„ ì‚¬ìš©í•´ì„œ structural sharingì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Question</h5></div><div class="admonition-content"><p>Q3. <code>immer</code>ì—ì„œëŠ” <code>produce</code>í•¨ìˆ˜ ë‚´ì—ì„œ ê°ì²´ë¥¼ ì§ì ‘ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ì´ ì•„ë‹ˆë¼ returnì„ í†µí•´ì„œ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²½ìš°ê°€ ìˆëŠ”ë°, ì´ëŸ° ê²½ìš°ì— immerì˜ ë¡œì§ì— ì°¨ì´ê°€ ìˆì„ê¹Œ?</p></div></div><p><code>produce</code> í•¨ìˆ˜ ë‚´ì—ì„œ returnì„ í•˜ëŠ”ì§€ ì•„ë‹Œì§€ ì—¬ë¶€ëŠ” immerì˜ finalize, ì—…ë°ì´íŠ¸ ëœ ê°ì²´ë¥¼ ì¤€ë¹„í•˜ëŠ” ê³¼ì •ì—ì„œ ì°¨ì´ê°€ ë‚œë‹¤.
returnì„ í•˜ì§€ ì•Šì€ ê²½ìš°ëŠ” <code>produce</code> ë‚´ë¶€ì—ì„œ ê°ì²´ë¥¼ ì§ì ‘ ë³€ê²½í–ˆë‹¤ëŠ” ì˜ë¯¸ì´ê³  ê·¸ë ‡ë‹¤ë©´ immerì—ì„œ êµ¬í˜„í•˜ëŠ” Proxyë¡œì§ì¸ get, setì„ ì´ìš©í•˜ì—¬
ê°ì²´ë¥¼ ì—…ë°ì´íŠ¸ í–ˆë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ë ‡ë‹¤ë©´ ì´ ê¸€ì—ì„œ ì•Œì•„ë³´ì•˜ë˜ <code>base_</code>, <code>copy_</code>, <code>modified_</code> ë“± ì—¬ëŸ¬ ë³€ìˆ˜ì™€ ë¡œì§ë“¤ì„ ì´ìš©í•´ì„œ ê°ì²´ ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•œë‹¤.</p><p>í•˜ì§€ë§Œ, returnì„ í•œë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œ? <code>produce</code>ì—ì„œ return ê°’ì´ ì¡´ì¬í•œë‹¤ë©´ immerì—ì„œ ì¤€ë¹„í•œ Proxy get, set ë“± ë¡œì§ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ 
ê²°ê³¼ê°’ì„ ê·¸ëŒ€ë¡œ ë¦¬í„´í•˜ê³  ìˆë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤. ë”°ë¼ì„œ root proxyë¥¼ í˜•ì„±í•˜ê³  getì„ í†µí•´ì„œ ê°ì²´ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  setìœ¼ë¡œ <code>modified_</code>ë¥¼ ë³€ê²½í•˜ëŠ” ë“± ë¡œì§ì„ ëª¨ë‘
ìŠ¤í‚µí•˜ê³  <code>finalize</code> ê³¼ì •ìœ¼ë¡œ ë„˜ì–´ì˜¨ë‹¤. ì´ëŠ” immerì˜ ëŒ€ë¶€ë¶„ì˜ ë¡œì§ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ê²°ê³¼ë¥¼ ë¦¬í„´í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.</p><p>ë‘ ë°©ë²• ëª¨ë‘ ê°ì²´ë¥¼ immutableí•˜ê²Œ ê´€ë¦¬í•˜ì—¬ ì—…ë°ì´íŠ¸í•œë‹¤. ê·¸ë¦¬ê³  ë‘ ë°©ì‹ ëª¨ë‘ ë³€ê²½ëœ ê°ì²´ë§Œ referenceê°€ ë°”ë€ŒëŠ” structural sharingì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤.
ë¬¼ë¡  ë‘ë²ˆì§¸ ë°©ë²•, ì—…ë°ì´íŠ¸ ëœ ê°ì²´ë¥¼ ë¦¬í„´í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤ë©´ ë¶ˆí•„ìš”í•˜ê²Œ ê°ì²´ë¥¼ ìƒˆë¡œ ë§Œë“¤ì§€ ì•Šê²Œ ì£¼ì˜ëŠ” í•„ìš”í•˜ë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ì´ì•¼ê¸°í•˜ë©´ ì–´ëŠìª½ì´ë“  ë™ì¼í•˜ë‹¤.
ì°¨ì´ì ì„ ê³ ë¥´ìë©´ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ê°ì²´ë¥¼ ë³€ê²½í•˜ëŠëƒì— ëŒ€í•œ ê²ƒì¼ ë¿ì´ë‹¤. ê·¸ë ‡ë‹¤ë©´ ì„ íƒì˜ ì˜ì—­ì´ë‹¤.
mutableí•˜ê²Œ ë³€ê²½í•˜ëŠ” ë°©ì‹ì„ ì„ íƒí•˜ëŠëƒ, immutableí•˜ê²Œ ë³€ê²½í•˜ëŠ” ë°©ì‹ì„ ì„ íƒí•˜ëŠëƒë¥¼ ê³ ë¯¼í•˜ë©´ ëœë‹¤. </p><p>ë¬¼ë¡ , ì£¼ê´€ì ì¸ ì˜ê²¬ì„ ì´ì•¼ê¸°í•˜ìë©´ ì–´ë–¤ ê°ì²´ë¥¼ ì–´ë–»ê²Œ ì—…ë°ì´íŠ¸ í•˜ê³ ìí•˜ëŠ”ì§€ ëª©ì ì— ë”°ë¼ì„œ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ì´ ë‹¬ë¼ì§„ë‹¤ê³  ìƒê°í•œë‹¤.
ë”°ë¼ì„œ immutableí•˜ê²Œ ë³€ê²½í•˜ëŠ” ë°©ì‹ì˜ ì¥ë‹¨ì , mutableí•˜ê²Œ ë³€ê²½í•˜ëŠ” ë°©ì‹ì˜ ì¥ë‹¨ì ì„ ê°ê° ì´í•´í•˜ê³ , ìƒí™©ì— ë§ê²Œ í˜¼ìš©í•´ì„œ ì‚¬ìš©ì„ í•˜ë©´ ë  ê²ƒì´ë¼ê³  ìƒê°í•œë‹¤.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="reference"></a>Reference<a class="hash-link" href="#reference" title="ì œëª©ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°">#</a></h2><ul><li><a href="https://immerjs.github.io/immer/" target="_blank" rel="noopener noreferrer">immer official docs</a></li><li><a href="https://github.com/immerjs/immer/tree/v9.0.6" target="_blank" rel="noopener noreferrer">immer repository v9.0.6</a></li><li><a href="https://ko.redux.js.org/style-guide/style-guide/#use-redux-toolkit-for-writing-redux-logic" target="_blank" rel="noopener noreferrer">redux style guide</a> </li><li><a href="https://redux-toolkit.js.org/api/createReducer#direct-state-mutation" target="_blank" rel="noopener noreferrer">redux-toolkit guide</a></li><li><a href="https://medium.com/hackernoon/introducing-immer-immutability-the-easy-way-9d73d8f71cb3#3bff" target="_blank" rel="noopener noreferrer">[blog] Introducing immer: Immutability the easy way</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener noreferrer">Proxy MDN</a></li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>íƒœê·¸:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/redux">redux</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/redux-toolkit">redux-toolkit</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/immer">immer</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/library">library</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/how-to-work">how-to-work</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/deep-dive">deep-dive</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/javascript">javascript</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/web">web</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/immutable">immutable</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ íƒìƒ‰"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/how-to-time-travel-debugging-at-redux-devtools"><div class="pagination-nav__sublabel">ë‹¤ìŒ ê²Œì‹œë¬¼</div><div class="pagination-nav__label">redux-devtoolsì˜ time-travel-debugging í†ºì•„ë³´ê¸° Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ë¬´ì—‡ì´-ê¶ê¸ˆí• ê¹Œ" class="table-of-contents__link">ë¬´ì—‡ì´ ê¶ê¸ˆí• ê¹Œ?</a></li><li><a href="#immerëŠ”-ë¬´ì—‡ì´ê³ -ì™œ-ì‚¬ìš©í•˜ëŠ”ê±¸ê¹Œ" class="table-of-contents__link">ImmerëŠ” ë¬´ì—‡ì´ê³ , ì™œ ì‚¬ìš©í•˜ëŠ”ê±¸ê¹Œ?</a></li><li><a href="#ì‚¬ìš©ë²•" class="table-of-contents__link">ì‚¬ìš©ë²•</a></li><li><a href="#deep-dive-ì „-immerì—-ëŒ€í•´ì„œ" class="table-of-contents__link">deep-dive ì „ immerì— ëŒ€í•´ì„œ</a><ul><li><a href="#immerëŠ”-ì›ë˜-ê°ì²´ë¥¼-ë³€ê²½ì‹œí‚¤ì§€-ì•ŠëŠ”ë‹¤" class="table-of-contents__link">immerëŠ” ì›ë˜ ê°ì²´ë¥¼ ë³€ê²½ì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤.</a></li><li><a href="#immerëŠ”-ê°ì²´ê°€-ë³€ê²½ë˜ì—ˆëŠ”ì§€ë¥¼-ê¸°ë¡í•œë‹¤" class="table-of-contents__link">immerëŠ” ê°ì²´ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ë¥¼ ê¸°ë¡í•œë‹¤.</a></li><li><a href="#recap" class="table-of-contents__link">Recap</a></li></ul></li><li><a href="#deep-dive-to-immer" class="table-of-contents__link">Deep dive to immer</a><ul><li><a href="#scope" class="table-of-contents__link">scope</a></li><li><a href="#proxy" class="table-of-contents__link">proxy</a></li><li><a href="#new-proxy" class="table-of-contents__link">new Proxy</a></li><li><a href="#traps-of-immer" class="table-of-contents__link">Traps of immer</a></li><li><a href="#recap-of-proxy" class="table-of-contents__link">Recap of Proxy</a></li></ul></li><li><a href="#finalize" class="table-of-contents__link">finalize</a><ul><li><a href="#root-proxyë¥¼-ì‚¬ìš©í•˜ëŠ”-finalize" class="table-of-contents__link">root proxyë¥¼ ì‚¬ìš©í•˜ëŠ” finalize</a></li><li><a href="#recipeì˜-returnì„-ì‚¬ìš©í•˜ëŠ”-finalize" class="table-of-contents__link">recipeì˜ returnì„ ì‚¬ìš©í•˜ëŠ” finalize</a></li></ul></li><li><a href="#recap-1" class="table-of-contents__link">Recap</a></li><li><a href="#ê¶ê¸ˆì¦-í•´ì†Œ" class="table-of-contents__link">ê¶ê¸ˆì¦ í•´ì†Œ</a></li><li><a href="#reference" class="table-of-contents__link">Reference</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li><li class="footer__item"><a href="https://github.com/HyunmoAhn" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div>Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>Copyright Â© 2021 Hyunmo Ahn. Built with Docusaurus.
</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1447f857.js"></script>
<script src="/assets/js/main.47fa5a87.js"></script>
</body>
</html>